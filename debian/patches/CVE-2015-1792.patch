From dd90a91d8771fd1ad5083fd46a2b3da16a587757 Mon Sep 17 00:00:00 2001
From: "Dr. Stephen Henson" <steve@openssl.org>
Date: Fri, 5 Jun 2015 12:11:25 +0100
Subject: [PATCH] Fix infinite loop in CMS

Fix loop in do_free_upto if cmsbio is NULL: this will happen when attempting
to verify and a digest is not recognised. Reported by Johannes Bauer.

CVE-2015-1792

Reviewed-by: Matt Caswell <matt@openssl.org>
---
 crypto/cms/cms_smime.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: openssl-1.0.1k/crypto/cms/cms_smime.c
===================================================================
--- openssl-1.0.1k.orig/crypto/cms/cms_smime.c
+++ openssl-1.0.1k/crypto/cms/cms_smime.c
@@ -141,7 +141,7 @@ static void do_free_upto(BIO *f, BIO *up
 			BIO_free(f);
 			f = tbio;
 			}
-		while (f != upto);
+                while (f && f != upto);
 		}
 	else
 		BIO_free_all(f);
